/*
 * Â© 2025 Platform Engineering Labs Inc.
 *
 * SPDX-License-Identifier: FSL-1.1-ALv2
 */

import "@formae/formae.pkl"
import "@oci/oci.pkl"

projectName = "oke-example"
ociRegion = "us-chicago-1"
k8sVersion = "v1.34.1"

// Network config
vcnCidr = "10.0.0.0/16"
serviceLbSubnetCidr = "10.0.1.0/24"    // For K8s LoadBalancer services (public)
workerNodeSubnetCidr = "10.0.2.0/24"   // For worker nodes (private)

// Node pool config
vmShape = "VM.Standard.E4.Flex"
nodeOcpus = 2.0
nodeMemoryGBs = 16.0
nodePoolSize = 2

// Properties (CLI flags)
props = new Dynamic {
    compartmentId = new formae.Prop {
        flag = "compartmentId"
        default = "ocid1.tenancy.oc1..aaaaaaaakxm3lo5ntsbsmx3n6epvrntxsmjg6eypafyi2ldngr6bsclpcdta"
    }

    availabilityDomain = new formae.Prop {
        flag = "availabilityDomain"
        default = "Twhb:US-CHICAGO-1-AD-1"
    }

    // OKE-optimized node image for your region and K8s version
    // Find images: oci ce node-pool-options get --node-pool-option-id all --compartment-id <compartment-id>
    nodeImageId = new formae.Prop {
        flag = "nodeImageId"
        // OKE Oracle Linux 8.10 for K8s v1.34.1 in us-chicago-1 (x86_64)
        default = "ocid1.image.oc1.us-chicago-1.aaaaaaaasyjphzjohvvrttbw66amaxx6otldb26fvvn4nsogrvzsq2t6vama"
    }
    
    // Service Gateway service ID for OCI services
    // Find: oci network service list --compartment-id <compartment-id> --query "data[?contains(name, 'Services')].{Name:name, Id:id}"
    serviceGatewayServiceId = new formae.Prop {
        flag = "serviceGatewayServiceId"
        default = "ocid1.service.oc1.us-chicago-1.aaaaaaaakalxenk3rcszv74eamyc6dkjq6ngikfsdpctsll4nxw2lnfqbpbq"
    }
}

stack: formae.Stack = new {
    label = projectName
    description = "OKE Kubernetes Cluster on OCI"
}

target: formae.Target = new formae.Target {
    label = "oci-target"
    config = new oci.Config {
        region = module.ociRegion
        profile = "DEFAULT"
    }
}
